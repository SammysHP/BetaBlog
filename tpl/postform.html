<?php
/*
    $this->htmlescape()
    $this->post
*/
?>
<script>
    // from http://stackoverflow.com/questions/3964710/replacing-selected-text-in-the-textarea
    function getInputSelection(el) {
        var start = 0, end = 0, normalizedValue, range,
            textInputRange, len, endRange;
        if (typeof el.selectionStart == "number" && typeof el.selectionEnd == "number") {
            start = el.selectionStart;
            end = el.selectionEnd;
        } else {
            range = document.selection.createRange();
            if (range && range.parentElement() == el) {
                len = el.value.length;
                normalizedValue = el.value.replace(/\r\n/g, "\n");
                textInputRange.moveToBookmark(range.getBookmark());
                endRange = el.createTextRange();
                endRange.collapse(false);
    
                if (textInputRange.compareEndPoints("StartToEnd", endRange) > -1) {
                    start = end = len;
                } else {
                    start = -textInputRange.moveStart("character", -len);
                    start += normalizedValue.slice(0, start).split("\n").length - 1;
    
                    if (textInputRange.compareEndPoints("EndToEnd", endRange) > -1) {
                        end = len;
                    } else {
                        end = -textInputRange.moveEnd("character", -len);
                        end += normalizedValue.slice(0, end).split("\n").length - 1;
                    }
                }
            }
        }
        return {
            start: start,
            end: end
        };
    }
    
    function surroundSelectedText(el, before, after) {
        var sel = getInputSelection(el)
        var val = el.value;
        el.value = val.slice(0, sel.start) + before + val.slice(sel.start, sel.end) + after + val.slice(sel.end);
    }
    
    function escapeSelectedText(el) {
        var sel = getInputSelection(el)
        var val = el.value;
        var text = String(val.slice(sel.start, sel.end)).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
        el.value = val.slice(0, sel.start) + text + val.slice(sel.end);
    }
    
    function unescapeSelectedText(el) {
        var sel = getInputSelection(el)
        var val = el.value;
        var text = String(val.slice(sel.start, sel.end)).replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&amp;/g, '&');
        el.value = val.slice(0, sel.start) + text + val.slice(sel.end);
    }
    
    function replaceSelectedText(el, text) {
        var sel = getInputSelection(el);
        var val = el.value;
        el.value = val.slice(0, sel.start) + text + val.slice(sel.end);
    }
</script>
<form action="#" method="POST">
    <table id="postform" border="0" cellspacing="20" cellpadding="0">
        <tr>
            <td class="left">Titel:</td><td><input type="text" tabindex="1" name="title" id="title" class="inputfield" value="<?php echo $this->htmlescape($this->post->getTitle()); ?>" /></td>
        </tr>
        <tr>
            <td class="left">Datum:</td><td><input type="text" tabindex="2" name="date" class="inputfield" value="<?php echo date("Y-m-d H:i:s", $this->post->getDate()); ?>" /></td>
        </tr>
        <tr>
            <td class="left">Ver√∂ffentlicht:</td><td><input type="checkbox" tabindex="3" name="published" <?php if ($this->post->isPublished()) echo 'checked="checked" '; ?>/></td>
        </tr>
        <tr>
            <td class="left">
                Inhalt:
                <div style="color: #aaaaaa; padding-top: 1em;">
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '<b>', '</b>'); return false;"><b>B</b></a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '<i>', '</i>'); return false;"><i>I</i></a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '<u>', '</u>'); return false;"><u>U</u></a><br />
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '', '<br />'); return false;">br</a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '<p>\n', '\n</p>'); return false;">p</a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '<a href=&quot;&quot;>', '</a>'); return false;">a</a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('contenttextarea'), '<img src=&quot;&quot;>', '</img>'); return false;">img</a><br />
                    <a href="#" onClick="escapeSelectedText(document.getElementById('contenttextarea')); return false;">escape</a> <br />
                    <a href="#" onClick="unescapeSelectedText(document.getElementById('contenttextarea')); return false;">unescape</a>
                </div>
            </td>
            <td><textarea rows="15" tabindex="4" name="content" class="inputfield" id="contenttextarea"><?php echo $this->htmlescape($this->post->getContent()); ?></textarea></td>
        </tr>
        <tr>
            <td class="left">
                Erweitert:
                <div style="color: #aaaaaa; padding-top: 1em;">
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '<b>', '</b>'); return false;"><b>B</b></a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '<i>', '</i>'); return false;"><i>I</i></a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '<u>', '</u>'); return false;"><u>U</u></a><br />
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '', '<br />'); return false;">br</a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '<p>\n', '\n</p>'); return false;">p</a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '<a href=&quot;&quot;>', '</a>'); return false;">a</a>
                    <a href="#" onClick="surroundSelectedText(document.getElementById('extendedtextarea'), '<img src=&quot;&quot;>', '</img>'); return false;">img</a><br />
                    <a href="#" onClick="escapeSelectedText(document.getElementById('extendedtextarea')); return false;">escape</a> <br />
                    <a href="#" onClick="unescapeSelectedText(document.getElementById('extendedtextarea')); return false;">unescape</a>
                </div>
            </td>
            <td><textarea rows="30" tabindex="5" name="extended" class="inputfield" id="extendedtextarea"><?php echo $this->htmlescape($this->post->getExtended()); ?></textarea></td>
        </tr>
        <tr>
            <td class="left">Tags:</td><td><input type="text" tabindex="6" name="tags" class="inputfield" value="<?php echo $this->htmlescape(implode(' ', $this->post->getTags())); ?>" /></td>
        </tr>
        <tr>
            <td class="left"></td><td><input type="submit" tabindex="7" value="Speichern" name="save" /> <input type="submit" tabindex="8" value="Absenden" name="submit" /></td>
        </tr>
    </table>
</form>
<script>
    document.getElementById('title').focus();
</script>
