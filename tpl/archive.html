<?php
/*
    $this->posts
    $this->baseurl
    $this->loggedin
*/

echo '<div class="archive">';

$year = 0;
$close = false;

foreach ($this->posts as $post) {
    if ($year == 0 || ((int) date("Y", $post->getDate())) < $year) {
        if ($year != 0) {
            echo '</table>';
        }
        $year = (int) date("Y", $post->getDate());
        echo '<h2>' . $year . '</h2>';
        echo '<table class="table">';
        $close = true;
    }
    
    echo '<tr>';
        echo '<td class="left">' . date("d.m.Y H:i", $post->getDate()) . '</td><td>';
        
        if ($this->loggedin) { ?>
        <div class="adminbox">
            <a href="<?php echo $this->baseurl . 'post/' . $post->getId() . '/edit';   ?>">bearbeiten</a>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <a href="<?php echo $this->baseurl . 'post/' . $post->getId() . '/delete'; ?>">löschen</a>
            <?php
            if (!$post->isPublished()) {
                echo '<br /><span style="color: red;">nicht veröffentlicht</span>';
            }
            ?>
        </div>
        <?php }
        
        echo '<a href="' . $this->baseurl . 'post/' . $post->getId() . '">' . $post->getTitle() . '</a>';
        echo '<div class="tags" style="text-align: left;">';
        $tags = array();
        foreach ($post->getTags() as $tag) {
            $tags[] = '<a href="' . $this->baseurl . 'tag/' . str_replace('%2F', '/', rawurlencode($tag)) . '">' . $this->htmlescape($tag) . '</a>';
        }
        echo implode(', ', $tags);
        echo '</div>';
        echo '</td>';
    echo '</tr>';
}

if ($close) {
    echo '</table>';
}

echo '</div>';
